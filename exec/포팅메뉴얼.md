# ğŸ“ƒì‹œì†Œ í¬íŒ… ë©”ë‰´ì–¼
### [ğŸ”—ì‹œì†Œ í¬íŒ…ë©”ë‰´ì–¼ ë°”ë¡œê°€ê¸°](https://strong-pram-579.notion.site/88c87a143d804f79bb30f772afb3e04e?pvs=4)


### ëª©ì°¨

1. [ê°œë°œí™˜ê²½](#1-ê°œë°œ-í™˜ê²½)
2. [ë°°í¬(CI/CD) í™˜ê²½ êµ¬ì¶•](#2-ë°°í¬cicd-í™˜ê²½-êµ¬ì¶•)
    
    [2-1. MariaDB ì„¤ì¹˜](#2-1-mariadb-ì„¤ì¹˜)
    
    [2-2. Redis ì„¤ì¹˜](#2-2-redis-ì„¤ì¹˜)
    
    [2-3. Docker ì„¤ì¹˜](#2-3-docker-ì„¤ì¹˜)
    
    [2-4. Jenkins ì„¤ì¹˜ ë° ì„¤ì •](#2-4-jenkins-ì„¤ì¹˜-ë°-ì„¤ì •)
    
    [2-5. Jenkins ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— Docker ì„¤ì¹˜](#2-5-jenkins-ì»¨í…Œì´ë„ˆ-ë‚´ë¶€ì—-docker-ì„¤ì¹˜)
    
    [2-6. NGINX & SSL](#2-6-nginx--ssl)
    
3. [ë¹Œë“œ ë° ë°°í¬](#3-ë¹Œë“œ-ë°-ë°°í¬)
    
    [3-1 Jenkinsfile](#3-1-jenkinsfile)
    
    [3-2. Dockerfile](#3-2-dockerfile)
    
    [3-3. application.properties](#3-3-applicationproperties)
    
4. [ë¡œì»¬í™˜ê²½ ì‹¤í–‰](#4-ë¡œì»¬í™˜ê²½-ì‹¤í–‰)

## 1. ê°œë°œ í™˜ê²½

### Backend

- Java 17
- SpringBoot 3.1.1
- JPA
- SpringSecurity
- JWT

### FrontEnd

- Next.js 13
- TypeScript 5.2
- Redux-Toolkit 1.9.5
- React-Query 4
- Tailwind CSS 3.3.3
- DaisyUI 3.6.2 -
- pnpm 8

### DB

- MariaDB 10.3.38
- Redis 5.0.7
- S3

### EC2 Port

|  | EC2 port |
| --- | --- |
| ì‹œì†Œ BE | 8080 |
| ì‹œì†Œ ë±…í¬ BE | 8081 |
| ì‹œì†Œ FE | 3000 |
| MariaDB | 3306 |
| Redis | 6379 |
| Jenkins | 3333 |
| NGINX  | 80 / 443 |

### Infra

- EC2 ubuntu 20.04
- Docker 24.0.6
- Jenkins 2.425
- NGINX 1.18.0 (Ubuntu)

## 2. ë°°í¬(CI/CD) í™˜ê²½ êµ¬ì¶•

## 2-1. MariaDB ì„¤ì¹˜

```bash
sudo apt update
sudo apt-get upgrade

# mariadb ì„¤ì¹˜
sudo apt-get install mariadb-server

# root ê³„ì • ë¹„ë°€ë²ˆí˜¸ ì„¤ì •
use mysql;

update user set password = password('ì„¤ì •í•  ë¹„ë°€ë²ˆí˜¸') where user='root';
flush privileges;

# ìƒˆë¡œìš´ ê³„ì • ë§Œë“¤ê¸°
create user 'ê³„ì •ëª…'@'%' identified by 'ì„¤ì •í•  ë¹„ë°€ë²ˆí˜¸';
create database ë°ì´í„°ë² ì´ìŠ¤ëª…;

# ì™¸ë¶€ì—ì„œ ì ‘ì†ì´ í•„ìš”í•œ ê³„ì •ì´ê±°ë‚˜ ì ‘ê·¼ ì œí•œì´ í•„ìš”ì—†ëŠ” ê²½ìš°ëŠ” %ë¡œ ì ‘ê·¼ ëŒ€ìƒì„ í™•ëŒ€ ì ìš©
grant all privileges on ë°ì´í„°ë² ì´ìŠ¤ëª….* to 'ê³„ì •ëª…'@'%';

flush privileges;

# ì„¤ì •ì´ ì˜ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ë³´ê¸°
select host, user from mysql.user;
```

## 2-2. Redis ì„¤ì¹˜

```bash
sudo apt-get update
sudo apt-get upgrade

# redis ì„¤ì¹˜
sudo apt-get install redis-server

# redis ì‹¤í–‰
sudo systemctl start redis-server

# ë¡œì»¬ì—ì„œ EC2 ì¸ìŠ¤í„´ìŠ¤ì— ì„¤ì¹˜ëœ redisì— ì ‘ì†í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •
sudo vi /etc/redis/redis.conf
```

redis ì ‘ì† ë¹„ë°€ë²ˆí˜¸ ì„¤ì •

`requirepass foobared` ë¶€ë¶„ ì£¼ì„ ì œê±°í•˜ê³  `footbared`ë¥¼ ì›í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¡œ ë³€ê²½

redisì— ì ‘ì† ê°€ëŠ¥í•œ ip ì£¼ì†Œ ì„¤ì •

bind `127.0.0.1 ::1` ë¥¼ `0.0.0.0` ë¡œ ë³€ê²½

```bash
# ë¡œì»¬ì—ì„œ EC2ì„œë²„ì— ì„¤ì¹˜í•œ redis ì ‘ì†
redis-cli -h j9a409.p.ssafy.io -p 6379 -a [redis.confì— ì„¤ì •í•œ ë¹„ë°€ë²ˆí˜¸]
```

## 2-3. Docker ì„¤ì¹˜

```bash
# í”„ë¡œê·¸ë¨ ì„¤ì¹˜ ì „ ìš°ë¶„íˆ¬ ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸
sudo apt-get update

# í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg-agent \
    software-properties-common

# Dockerì˜ ê³µì‹ GPGí‚¤ ì¶”ê°€
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/debian/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg

# repository ì„¤ì •
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian \
  $(lsb_release -cs) stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null

sudo apt-cache policy docker-ce
# ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸
sudo apt-get update
# Docker ì„¤ì¹˜ í™•ì¸
sudo apt-get install docker-ce docker-ce-cli containerd.io

# ë„ì»¤ ì„¤ì¹˜ í™•ì¸
sudo docker
sudo systemctl status docker

# sudo ì—†ì´ ë„ì»¤ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ìì‹ ì˜ ec2 ì‚¬ìš©ì ì´ë¦„ì„ docker ê·¸ë£¹ì— ì¶”ê°€
# exit í•˜ê³  ec2 ì— ì¬ì ‘ì† í•˜ë©´ sudo ì—†ì´ ë„ì»¤ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
sudo usermod -aG docker [ec2 ì‚¬ìš©ìì´ë¦„]
```

## 2-4. Jenkins ì„¤ì¹˜ ë° ì„¤ì •

```bash
# jenkins ì´ë¯¸ì§€ pull ë°›ê¸°
docker pull jenkins/jenkins:jdk17

# jenkins ë„ì»¤ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
docker run --name jenkins -d -p 3333:8080 -p 50000:50000 \
-v /home/jenkins:/var/jenkins_home -v /var/run/docker.sock:/var/run/docker.sock \
-u root jenkins/jenkins:jdk17
```

`-p 3333:8080` : jenkins portë¥¼ 3333ìœ¼ë¡œ ë³€ê²½ (8080ì€ ë°±ì—”ë“œ port ì—¬ì„œ jenkins port ë³€ê²½)

`-v /var/run/docker.sock:/var/run/docker.sock` : Jenkins ë„ì»¤ ë‚´ë¶€ì— ë„ì»¤ë¥¼ ì„¤ì¹˜ í•˜ê¸° ìœ„í•´ì„œ ë³¼ë¥¨ ë§ˆìš´íŒ… ì„¤ì •

## 2-5. Jenkins ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— Docker ì„¤ì¹˜

Jenkins ì»¨í…Œì´ë„ˆì—ì„œ ë°±ì—”ë“œ, í”„ë¡ íŠ¸ì—”ë“œ ë„ì»¤ë¥¼ ë¹Œë“œí•˜ê¸° ìœ„í•´ì„œ Jenkins ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— Docker ì„¤ì¹˜

```bash
# jenkins container ì ‘ì†
docker exec -it jenkins /bin/bash
 
# linux ë²„ì „ í™•ì¸
cat /etc/issue
# --------------- OS --------------------------------
# root@DESKTOP-R4P59B3:/home/opendocs# cat /etc/issue
# Ubuntu 20.04.4 LTS \n \l
# --------------- jenkins Container OS --------------------------------
# root@DESKTOP-R4P59B3:/home/opendocs# docker exec -it jenkins /bin/bash
# root@8fc963af71bb:/# cat /etc/issue
# Debian GNU/Linux 11 \n \l
 
# Docker ì„¤ì¹˜
## - Old Version Remove
apt-get remove docker docker-engine docker.io containerd runc
## - Setup Repo
apt-get update
apt-get install apt-transport-https ca-certificates curl gnupg lsb-release
mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/debian/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian \
  $(lsb_release -cs) stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null
## - Install Docker Engine
apt-get update
apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin

# Docker-Compose ì„¤ì¹˜
curl -L https://github.com/docker/compose/releases/download/v2.21.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose
```

## 2-6. NGINX & SSL

### NGINX ì„¤ì¹˜

EC2 ì„œë²„ì— NGINX ì„¤ì¹˜

```bash
sudo apt-get update

sudo apt-get install nginx

```

### NGINX ì„¤ì •

default.conf - ë¦¬ë²„ìŠ¤í”„ë¡ì‹œ ì„¤ì •

default.conf íŒŒì¼ ìˆ˜ì • í›„ `sudo systemctl restart nginx` ë¡œ NGINX ì¬ì‹œì‘í•´ì•¼í•¨!

```bash
# /etc/nginx/sites-available/default.conf

upstream seesaw_front {
    server 0.0.0.0:3000;
}
upstream seesaw_back {
    server 0.0.0.0:8080;
}
upstream seesawbank_back {
    server 0.0.0.0:8081;
}

server {
    listen 80;
    server_name j9a409.p.ssafy.io;

    return 301 https://$host$request_uri;
}

server {
    server_name j9a409.p.ssafy.io;

    location / {
            proxy_pass http://seesaw_front;
        }

    location /seesaw {
        proxy_pass http://seesaw_back;
    }

    location /seesawbank {
        proxy_pass http://seesawbank_back;
    }

		# ì•„ë˜ ë‚´ìš©ì€ SSL ì ìš©ì‹œ ìƒì„±ë¨
    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/j9a409.p.ssafy.io/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/j9a409.p.ssafy.io/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
}
```

### SSL ì ìš©

### certbotì„ ì‚¬ìš©í•´ì„œ ì¸ì¦ì„œ ë°œê¸‰

```bash
# certbotì„ snap ëª…ë ¹ì–´ë¡œ ì„¤ì¹˜, ì‹¤í–‰í•˜ê¸° ë•Œë¬¸ì— snapì„ ë¨¼ì € ì„¤ì¹˜í•œë‹¤
sudo snap install core
sudo snap refresh core

# ê¸°ì¡´ì— ì„¤ì¹˜ëœ certbotì„ ì œê±°í•œë‹¤
# ê³µì‹ ê°€ì´ë“œì—ì„  certbotëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•  ë•Œ snapì´ ì‚¬ìš©ë˜ê²Œ í•˜ê¸° ìœ„í•¨ì´ë¼ê³  ì„¤ëª…í•œë‹¤
sudo apt-get remove certbot

# certbotì„ ì„¤ì¹˜í•œë‹¤
sudo snap install --classic certbot

# certbot ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë  ìˆ˜ ìˆê²Œ ì„¸íŒ…í•œë‹¤
sudo ln -s /snap/bin/certbot /usr/bin/certbot

# certbotìœ¼ë¡œ ì¸ì¦ì„œ ë°œê¸‰
sudo certbot --nginx -d j9a409.p.ssafy.io

# ì•„ë˜ ëª…ë ¹ì–´ë¡œ ìë™ ë¦¬ë‰´ì–¼ì´ ì ìš©ë˜ê³  ìˆëŠ”ì§€ í™•ì¸
sudo certbot renew --dry-run
```

ì•„ë˜ ê²½ë¡œì— pemí‚¤ ì €ì¥ë¨

```bash
Certificate is saved at: /etc/letsencrypt/live/j9a409.p.ssafy.io/fullchain.pem
Key is saved at:         /etc/letsencrypt/live/j9a409.p.ssafy.io/privkey.pem
```

### Springbootì— SSL ì ìš©

Springbootì— SSLì„ ì ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” pemí‚¤ë¥¼ PKCS12ë¡œ ë³€í™˜í•´ì•¼í•¨

```bash
# root ê³„ì •ìœ¼ë¡œ ì ‘ê·¼
sudu su

# letsencrypt ì¸ì¦ì„œê°€ ìˆëŠ” ê²½ë¡œë¡œ ì´ë™
cd /etc/letsencrypt/live/[your domain]

# PKCS12ë¡œ ë³€í™˜
openssl pkcs12 -export -in fullchain.pem -inkey privkey.pem -out cert_and_key.p12 -name [project name]

# ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ => ë¹„ë°€ë²ˆí˜¸ ê¼­ ê¸°ì–µí•˜ê¸°!!
```

```bash
# cert_and_key.p12 íŒŒì¼ì„ í”„ë¡œì íŠ¸ì˜ resources í´ë”ì— ë³µì‚¬
# ì‹œì†Œ
cd cert_and_key.p12 jenkins:/var/jenkins_home/workspace/seesawPJT/back/seesaw/src/main/resources
# ì‹œì†Œ ë±…í¬
cd cert_and_key.p12 jenkins:/var/jenkins_home/workspace/seesawPJT/back/seesawbank/src/main/resources
```

## 3. ë¹Œë“œ ë° ë°°í¬

## 3-1. Jenkinsfile

### Backend Jenkinsfile

```bash
pipeline {
    agent any

    stages {

        stage('Add Secret File') { // credentialsì— ì €ì¥í•´ë†“ì€ application.properties íŒŒì¼ ë³µì‚¬
	        steps {
                withCredentials([file(credentialsId: 'seesaw-application', variable: 'seesaw'),
                                file(credentialsId: 'seesawbank-application', variable: 'seesawbank')]) {
                    script {
                        sh 'mkdir -p /var/jenkins_home/workspace/seesawPJT/back/seesaw/src/main/resources'
                        sh 'cp $seesaw /var/jenkins_home/workspace/seesawPJT/back/seesaw/src/main/resources'

                        sh 'mkdir -p /var/jenkins_home/workspace/seesawPJT/back/seesawbank/src/main/resources'
                        sh 'cp $seesawbank /var/jenkins_home/workspace/seesawPJT/back/seesawbank/src/main/resources'
                    }
		        }
	        }
        }

        stage('ì‹œì†Œ - Docker Build') { // Docker ì´ë¯¸ì§€ ë¹Œë“œ ìŠ¤í…Œì´ì§€: Dockerfileì„ ê¸°ë°˜ìœ¼ë¡œ ì´ë¯¸ì§€ ë¹Œë“œ
            steps {
                dir('back/seesaw') {
                    sh 'docker build -t seesaw_back:latest .'
                }
            }

            post {
                success {
                    echo 'docker build success'
                }

                failure {
                    echo 'docker build failed'
                }
            }
        }

        stage('ì‹œì†Œë±…í¬ - Docker Build') { // Docker ì´ë¯¸ì§€ ë¹Œë“œ ìŠ¤í…Œì´ì§€: Dockerfileì„ ê¸°ë°˜ìœ¼ë¡œ ì´ë¯¸ì§€ ë¹Œë“œ
            steps {
                dir('back/seesawbank') {
                    sh 'docker build -t seesawbank_back:latest .'
                }
            }

            post {
                success {
                    echo 'docker build success'
                }

                failure {
                    echo 'docker build failed'
                }
            }
        }

        stage('deploy') {// ë°°í¬ ìŠ¤í…Œì´ì§€: ì´ì „ì— ì‹¤í–‰ ì¤‘ì¸ 'seesawbank_back' ì»¨í…Œì´ë„ˆë¥¼ ì œê±°í•˜ê³  ìƒˆë¡œìš´ ì´ë¯¸ì§€ë¡œ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰
            steps {
                // ì‹¤í–‰ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ì œê±°
                sh 'docker rm -f seesaw_back'
                sh 'docker rm -f seesawbank_back'
                
                // ìƒˆë¡œìš´ ì´ë¯¸ì§€ ì‹¤í–‰
                sh 'docker run -d --name seesaw_back -p 8080:8080 -e TZ=Asia/Seoul -u root seesaw_back:latest'
                sh 'docker run -d --name seesawbank_back -p 8081:8081 -e TZ=Asia/Seoul -u root seesawbank_back:latest'
            }

            post {
                success {
                    echo 'deploy success'
                }

                failure {
                    echo 'deploy failed'
                }
            }
        }

        stage('Finish') { // ì™„ë£Œ ìŠ¤í…Œì´ì§€: ë”ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” Docker ì´ë¯¸ì§€ ì œê±°
            steps {
                sh 'docker images -qf dangling=true | xargs -I{} docker rmi {}'
            }
        }
    }
}
```

### Frontend Jenkinsfile

```bash
pipeline {
    agent any

    stages {

        stage('Docker Build') {
            steps {
                dir('front') {
                    sh "docker build -t seesaw_front:latest ."
                }
            }

            post {
                success {
                    echo 'docker build success'
                }

                failure {
                    echo 'docker build failed'
                }
            }
        }

        stage('deploy') {// ë°°í¬ ìŠ¤í…Œì´ì§€: ì´ì „ì— ì‹¤í–‰ ì¤‘ì¸ 'seesawbank_back' ì»¨í…Œì´ë„ˆë¥¼ ì œê±°í•˜ê³  ìƒˆë¡œìš´ ì´ë¯¸ì§€ë¡œ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰
            steps {
                // ì‹¤í–‰ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ì œê±°
                sh 'docker rm -f seesaw_front'
                // ìƒˆë¡œìš´ ì´ë¯¸ì§€ ì‹¤í–‰
                sh 'docker run -d --name seesaw_front -p 3000:3000 -e TZ=Asia/Seoul -u root seesaw_front:latest'
            }

            post {
                success {
                    echo 'deploy success'
                }

                failure {
                    echo 'deploy failed'
                }
            }
        }

        stage('Finish') { // ì™„ë£Œ ìŠ¤í…Œì´ì§€: ë”ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” Docker ì´ë¯¸ì§€ ì œê±°
            steps {
                sh 'docker images -qf dangling=true | xargs -I{} docker rmi {}'
            }
        }
    }
}
```

## 3-2. Dockerfile

### Backend Dockerfile

seesaw Dockerfile

```bash
FROM gradle:8.2.1-jdk17-alpine AS builder
WORKDIR /app
# ê·¸ë˜ë“¤ íŒŒì¼ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œë§Œ ìƒˆë¡­ê²Œ ì˜ì¡´íŒ¨í‚¤ì§€ ë‹¤ìš´ë¡œë“œ ë°›ê²Œí•¨.
COPY build.gradle settings.gradle /app/
RUN gradle clean build -x test --parallel --continue > /dev/null 2>&1 || true
# ë¹Œë” ì´ë¯¸ì§€ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œ
COPY ./ ./
RUN gradle build -x test --parallel

FROM openjdk:17
WORKDIR /app
# ARG JAR_FILE=/build/libs/*.jar
COPY --from=builder /app/build/libs/*.jar /app/app.jar
# í•´ë‹¹ ì»¨í…Œì´ë„ˆëŠ” 8080 port ì‚¬ìš© (ìƒëµ ê°€ëŠ¥)
EXPOSE 8080
# docker run ì‹œ ì‹¤í–‰í•  í•„ìˆ˜ ëª…ë ¹ì–´
ENTRYPOINT ["java", "-jar", "app.jar"]

# ì‹œê°„ ì„¤ì •
ARG DEBIAN_FRONTEND=noninteractive
ENV TZ=Asia/Seoul
```

seesawbank Dockerfile

```bash
FROM gradle:8.2.1-jdk17-alpine AS builder
WORKDIR /app
# ê·¸ë˜ë“¤ íŒŒì¼ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œë§Œ ìƒˆë¡­ê²Œ ì˜ì¡´íŒ¨í‚¤ì§€ ë‹¤ìš´ë¡œë“œ ë°›ê²Œí•¨.
COPY build.gradle settings.gradle /app/
RUN gradle clean build -x test --parallel --continue > /dev/null 2>&1 || true
# ë¹Œë” ì´ë¯¸ì§€ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œ
COPY ./ ./
RUN gradle build -x test --parallel

FROM openjdk:17
WORKDIR /app
# ARG JAR_FILE=/build/libs/*.jar
COPY --from=builder /app/build/libs/*.jar /app/app.jar
# í•´ë‹¹ ì»¨í…Œì´ë„ˆëŠ” 8081 port ì‚¬ìš© (ìƒëµ ê°€ëŠ¥)
EXPOSE 8081
# docker run ì‹œ ì‹¤í–‰í•  í•„ìˆ˜ ëª…ë ¹ì–´
ENTRYPOINT ["java", "-jar", "app.jar"]

# ì‹œê°„ ì„¤ì •
ARG DEBIAN_FRONTEND=noninteractive
ENV TZ=Asia/Seoul
```

### Frontend Dockerfile

```bash
FROM node:20-alpine AS base

# Install dependencies only when needed
FROM base AS deps
# Check https://github.com/nodejs/docker-node/tree/b4117f9333da4138b03a546ec926ef50a31506c3#nodealpine to understand why libc6-compat might be needed.
RUN apk add --no-cache libc6-compat
WORKDIR /app

# Install dependencies based on the preferred package manager
COPY package.json pnpm-lock.yaml* ./
RUN  npm install -g pnpm && pnpm install

# Rebuild the source code only when needed
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .

RUN pnpm run build

# Production image, copy all the files and run next
FROM base AS runner
WORKDIR /app

ENV NODE_ENV production

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public

# Set the correct permission for prerender cache
RUN mkdir .next
RUN chown nextjs:nodejs .next

# Automatically leverage output traces to reduce image size
# https://nextjs.org/docs/advanced-features/output-file-tracing
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000

ENV PORT 3000

CMD ["node", "server.js"]
```

## 3-3. application.properties

seesaw application.properties

```bash
# context path
server.servlet.context-path=/seesaw
# server port
server.port=8080

# JDBC
spring.datasource.driver-class-name=org.mariadb.jdbc.Driver
spring.datasource.url=jdbc:mariadb://j9a409.p.ssafy.io:3306/seesaw?characterEncoding=utf8
# DB
spring.datasource.username=[mariadb username]
spring.datasource.password=[mariadb password]

#create the schema with the given values.
# spring.jpa.hibernate.ddl-auto=create
#To beautify or pretty print the SQL
spring.jpa.properties.hibernate.format_sql=true
#show sql
spring.jpa.properties.hibernate.show-sql=true
#show parameter binding
logging.level.org.hibernate.type.descriptor.sql=DEBUG
logging.level.org.hibernate.SQL=DEBUG

# -- Database Connection pool setting --
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.connection-init-sql=SELECT 1 FROM DUAL
spring.datasource.hikari.idleTimeout=10000
spring.datasource.hikari.connection-timeout=10000
spring.datasource.hikari.validation-timeout=10000
spring.datasource.hikari.maxLifetime=580000

# swagger
springdoc.packages-to-scan=com.doacha.seesaw
springdoc.swagger-ui.tags-sorter=alpha
springdoc.swagger-ui.operations-sorter=alpha
springdoc.api-docs.groups.enabled=true
springdoc.cache.disabled=true

# logging
logging.level.root=info
logging.level.com.doacha.seesaw.test=debug

# JWT
# secret key
jwt.secret=[jwt secret key]
# access token 1??
jwt.live.atk = 3600000
# refresh token 2?
jwt.live.rtk = 1209600000

#Redis
spring.data.redis.host=j9a409.p.ssafy.io
spring.data.redis.password= [redis password]
spring.data.redis.port=6379

#Mail
spring.mail.host=smtp.gmail.com
spring.mail.username = [gmail username]
spring.mail.password = [gmail password]
spring.mail.port = 587
spring.mail.protocol = smtp
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.timeout=5000
spring.mail.debug=true
spring.mail.default.encoding=UTF-8

# seesaw account
seesaw_account_number = [ì‹œì†Œ ê³„ì¢Œë²ˆí˜¸]
seesaw_account_password = [ì‹œì†Œ ê³„ì¢Œ ë¹„ë°€ë²ˆí˜¸]

# seesawBank API url
seesawBank_api = https://j9a409.p.ssafy.io:8081/seesawbank

#SSL
server.ssl.key-store=classpath:cert_and_key.p12
server.ssl.key-store-type=PKCS12
server.ssl.key-store-password=[SSL password]

# S3
cloud.aws.credentials.accessKey=[S3 access key]
cloud.aws.credentials.secretKey=[S3 secret key]
cloud.aws.s3.bucket=seesawawsbucket
cloud.aws.region.static=ap-northeast-2
cloud.aws.stack.auto-=false
```

seesawbank application.properties

```bash
# context path
server.servlet.context-path=/seesawbank
# server port
server.port=8081

# JDBC
spring.datasource.driver-class-name=org.mariadb.jdbc.Driver
spring.datasource.url=jdbc:mariadb://j9a409.p.ssafy.io:3306/seesawbank?characterEncoding=utf8
# DB
spring.datasource.username=[mariadb username]
spring.datasource.password=[mariadb password]

#create the schema with the given values
# spring.jpa.hibernate.ddl-auto=create
#To beautify or pretty print the SQL
spring.jpa.properties.hibernate.format_sql=true
#show sql
spring.jpa.properties.hibernate.show-sql=true
#show parameter binding
logging.level.org.hibernate.type.descriptor.sql=DEBUG
logging.level.org.hibernate.SQL=DEBUG

# -- Database Connection pool setting --
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.connection-init-sql=SELECT 1 FROM DUAL
spring.datasource.hikari.idleTimeout=10000
spring.datasource.hikari.connection-timeout=10000
spring.datasource.hikari.validation-timeout=10000
spring.datasource.hikari.maxLifetime=580000

# swagger
springdoc.packages-to-scan=com.doacha.seesawbank
springdoc.swagger-ui.tags-sorter=alpha
springdoc.swagger-ui.operations-sorter=alpha
springdoc.api-docs.groups.enabled=true
springdoc.cache.disabled=true

# logging
logging.level.root=info
logging.level.com.doacha.seesaw.test=debug

# JWT
# secret key
jwt.secret=[jwt secret key]
# access token
jwt.live.atk = 3600000
# refresh token
jwt.live.rtk = 1209600000

#SSL
server.ssl.key-store=classpath:cert_and_key.p12
server.ssl.key-store-type=PKCS12
server.ssl.key-store-password=[SSL password]
```

## 4. ë¡œì»¬í™˜ê²½ ì‹¤í–‰

### Backend

seesaw application.properties

```bash
# context path
server.servlet.context-path=/seesaw
# server port
server.port=8080

# JDBC
spring.datasource.driver-class-name=org.mariadb.jdbc.Driver
spring.datasource.url=jdbc:mariadb://j9a409.p.ssafy.io:3306/seesaw?characterEncoding=utf8
# DB
spring.datasource.username=[mariadb username]
spring.datasource.password=[mariadb password]

#create the schema with the given values.
# spring.jpa.hibernate.ddl-auto=create
#To beautify or pretty print the SQL
spring.jpa.properties.hibernate.format_sql=true
#show sql
spring.jpa.properties.hibernate.show-sql=true
#show parameter binding
logging.level.org.hibernate.type.descriptor.sql=DEBUG
logging.level.org.hibernate.SQL=DEBUG

# -- Database Connection pool setting --
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.connection-init-sql=SELECT 1 FROM DUAL
spring.datasource.hikari.idleTimeout=10000
spring.datasource.hikari.connection-timeout=10000
spring.datasource.hikari.validation-timeout=10000
spring.datasource.hikari.maxLifetime=580000

# swagger
springdoc.packages-to-scan=com.doacha.seesaw
springdoc.swagger-ui.tags-sorter=alpha
springdoc.swagger-ui.operations-sorter=alpha
springdoc.api-docs.groups.enabled=true
springdoc.cache.disabled=true

# logging
logging.level.root=info
logging.level.com.doacha.seesaw.test=debug

# JWT
# secret key
jwt.secret=[jwt secret key]
# access token 1??
jwt.live.atk = 3600000
# refresh token 2?
jwt.live.rtk = 1209600000

#Redis
spring.data.redis.host=j9a409.p.ssafy.io
spring.data.redis.password= [redis password]
spring.data.redis.port=6379

#Mail
spring.mail.host=smtp.gmail.com
spring.mail.username = [gmail username]
spring.mail.password = [gmail password]
spring.mail.port = 587
spring.mail.protocol = smtp
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.timeout=5000
spring.mail.debug=true
spring.mail.default.encoding=UTF-8

# seesaw account
seesaw_account_number = [ì‹œì†Œ ê³„ì¢Œë²ˆí˜¸]
seesaw_account_password = [ì‹œì†Œ ê³„ì¢Œ ë¹„ë°€ë²ˆí˜¸]

# seesawBank API url
seesawBank_api = http://localhost:8081/seesawbank

# S3
cloud.aws.credentials.accessKey=[S3 access key]
cloud.aws.credentials.secretKey=[S3 secret key]
cloud.aws.s3.bucket=seesawawsbucket
cloud.aws.region.static=ap-northeast-2
cloud.aws.stack.auto-=false
```

seesawbank application.properties

```bash
# context path
server.servlet.context-path=/seesawbank
# server port
server.port=8081

# JDBC
spring.datasource.driver-class-name=org.mariadb.jdbc.Driver
spring.datasource.url=jdbc:mariadb://j9a409.p.ssafy.io:3306/seesawbank?characterEncoding=utf8
# DB
spring.datasource.username=[mariadb username]
spring.datasource.password=[mariadb password]

#create the schema with the given values
# spring.jpa.hibernate.ddl-auto=create
#To beautify or pretty print the SQL
spring.jpa.properties.hibernate.format_sql=true
#show sql
spring.jpa.properties.hibernate.show-sql=true
#show parameter binding
logging.level.org.hibernate.type.descriptor.sql=DEBUG
logging.level.org.hibernate.SQL=DEBUG

# -- Database Connection pool setting --
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.connection-init-sql=SELECT 1 FROM DUAL
spring.datasource.hikari.idleTimeout=10000
spring.datasource.hikari.connection-timeout=10000
spring.datasource.hikari.validation-timeout=10000
spring.datasource.hikari.maxLifetime=580000

# swagger
springdoc.packages-to-scan=com.doacha.seesawbank
springdoc.swagger-ui.tags-sorter=alpha
springdoc.swagger-ui.operations-sorter=alpha
springdoc.api-docs.groups.enabled=true
springdoc.cache.disabled=true

# logging
logging.level.root=info
logging.level.com.doacha.seesaw.test=debug

# JWT
# secret key
jwt.secret=[jwt secret key]
# access token
jwt.live.atk = 3600000
# refresh token
jwt.live.rtk = 1209600000
```

<aside>
ğŸ’¡ ì‹œì†Œ Backend Server ì‹¤í–‰

`cd/back/seesaw`

`application Run`

ì‹œì†Œ ë±…í¬ Backend Server ì‹¤í–‰

`cd/back/seesawbank`

`application Run`

</aside>

### Frontend

<aside>
ğŸ’¡ pnpm ì„¤ì¹˜

`npm install -g pnpm`

package ì„¤ì¹˜

`pnpm install`

Frontend ì‹¤í–‰

`pnpm run dev`

</aside>